<!DOCTYPE html>
<html>
<head>
  <title>Simple SPA Test</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; bor der-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    #log { border: 1px solid #ddd; padding: 10px; min-height: 200px; background: #fafafa; max-height: 400px; overflow-y: auto; font-size: 12px; font-family: monospace; }
    .log-entry { margin: 4px 0; padding: 4px; }
    .log-entry.error { background: #ffebee; color: #c62828; }
    .log-entry.success { background: #e8f5e9; color: #2e7d32; }
    .log-entry.info { background: #e3f2fd; color: #1565c0; }
    .controls { margin-top: 20px; }
    button { padding: 10px 20px; margin-right: 10px; cursor: pointer; }
    #status { margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #2196F3; }
  </style>
</head>
<body>
  <div class="container">
    <h1>SPA Diagnostic Test</h1>
    
    <div id="log"></div>
    
    <div class="controls">
      <button onclick="testStructure()">Test DOM Structure</button>
      <button onclick="testStorage()">Test Storage</button>
      <button onclick="testLibraries()">Test Libraries</button>
      <button onclick="testApp()">Test App Init</button>
      <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="status">
      <strong>Status:</strong> <span id="statusText">Ready</span>
    </div>
  </div>

  <script>
    function log(msg, type = 'info') {
      const logEl = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = '[' + type.toUpperCase().padEnd(7) + '] ' + msg;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
      log('Log cleared', 'info');
    }

    function updateStatus(text) {
      document.getElementById('statusText').textContent = text;
    }

    function testStructure() {
      log('Testing DOM structure...', 'info');
      
      const elements = [
        { id: 'loginPage', name: 'Login Page' },
        { id: 'dashboardPage', name: 'Dashboard Page' },
        { id: 'loginForm', name: 'Login Form' },
        { id: 'loginUsername', name: 'Username Input' },
        { id: 'loginPassword', name: 'Password Input' },
        { id: 'gpaChart', name: 'GPA Chart Canvas' },
        { id: 'marksChart', name: 'Marks Chart Canvas' },
        { id: 'totalStudents', name: 'Total Students Stat' },
        { id: 'avgGPA', name: 'Avg GPA Stat' },
      ];
      
      let found = 0;
      elements.forEach(el => {
        const elem = document.getElementById(el.id);
        if (elem) {
          log('✓ Found: ' + el.name + ' (#' + el.id + ')', 'success');
          found++;
        } else {
          log('✗ Missing: ' + el.name + ' (#' + el.id + ')', 'error');
        }
      });
      
      log(found + '/' + elements.length + ' elements found', found === elements.length ? 'success' : 'error');
      updateStatus('DOM test complete: ' + found + '/' + elements.length);
    }

    function testStorage() {
      log('Testing localStorage...', 'info');
      
      try {
        localStorage.setItem('test', 'value');
        const val = localStorage.getItem('test');
        if (val === 'value') {
          log('✓ localStorage working', 'success');
        } else {
          log('✗ localStorage value mismatch', 'error');
        }
        localStorage.removeItem('test');
      } catch (e) {
        log('✗ localStorage error: ' + e.message, 'error');
      }
      
      updateStatus('Storage test complete');
    }

    function testLibraries() {
      log('Testing external libraries...', 'info');
      
      let loaded = 0;
      const libs = [];
      
      if (typeof Chart !== 'undefined') {
        log('✓ Chart.js loaded (version: ' + (Chart.version || 'unknown') + ')', 'success');
        libs.push('Chart.js');
        loaded++;
      } else {
        log('✗ Chart.js NOT loaded', 'error');
      }
      
      if (typeof html2pdf !== 'undefined') {
        log('✓ html2pdf loaded', 'success');
        libs.push('html2pdf');
        loaded++;
      } else {
        log('✗ html2pdf NOT loaded', 'error');
      }
      
      log('Libraries loaded: ' + loaded + '/2', loaded === 2 ? 'success' : 'error');
      updateStatus('Library test complete: ' + libs.join(', '));
    }

    function testApp() {
      log('Testing app initialization...', 'info');
      
      // Check if app classes exist (they'll be loaded by index.html)
      // For now, just check localStorage was initialized
      if (window.AppStorage) {
        log('✓ AppStorage class found', 'success');
        AppStorage.init();
        const users = AppStorage.get('users');
        if (users && users.length > 0) {
          log('✓ Default user created: ' + users[0].username, 'success');
        }
      } else {
        log('ℹ AppStorage not yet loaded (will load when main app.js runs)', 'info');
      }
      
      updateStatus('App init check complete');
    }

    // Auto-test on load
    window.addEventListener('load', () => {
      log('Page loaded, waiting for libraries...', 'info');
      setTimeout(() => {
        testStructure();
        testStorage();
        testLibraries();
      }, 1000);
    });

    log('Test page initialized', 'success');
  </script>
</body>
</html>
